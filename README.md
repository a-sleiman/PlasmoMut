# PlasmoMut: A Variant Discovery Pipeline
A reproducible bioinformatics workflow to identify candidate variants associated with treatment failure in *Plasmodium falciparum*. From raw sequencing data to variant filtering, this project documents every step needed to reproduce the full analysis and uncover candidate mutations.

---

## Project Goal

To identify mutations found exclusively in ACT treatment failure *P. falciparum* isolates, but absent in treatment success isolates. The ultimate aim is to generate a list of candidate variants potentially linked to antimalarial resistance.

---

## Repository Structure

| Folder / File                  | Description                                                        |
| ------------------------------ | ------------------------------------------------------------------ |
| `bash_scripts/`                | Shell scripts for mapping, BAM/VCF generation, file checks         |
| ├── `RawFq2MergedVCF.sh`       | Main pipeline: maps FASTQ → BAM → joint VCF                        |
| ├── `Pick_md5.sh`              | Helper script to verify FASTQ integrity with md5 checksums         |
| `R_scripts/`                   | R scripts for downstream analysis                                  |
| ├── `PlasmoMutFinder.R`        | Filters merged VCF to keep variants exclusive to the failure group |
| ├── `SeqQualPlot15.R`          | Produces QC plots (mapping %, Sankey diagram, read distribution)   |
| `annotations/`                 | Genome annotations and helper files for variant interpretation     |
| ├── `Pfalciparum.gff3`         | Gene annotation file                                               |
| ├── `drug_resistance_genes.*`  | Lists and regions for known drug-resistance genes                  |
| ├── `snpEffdata/`              | snpEff configuration and reference data                            |
| `known_sites/`                 | Known variant databases (for BQSR and recalibration)               |
| `input_data/`                  | Input sequencing and metadata files                                |
| ├── `*.fastq`                  | Raw Illumina paired-end reads                                      |
| ├── `Pfalciparum.genome.fasta` | Reference genome FASTA                                             |
| ├── `labels.xlsx`              | Sample metadata (`Sample`, `Group`)                                |
| ├── `New15Targets.bed`         | Target regions for on-target read QC                               |
| `output_data/`                 | Results generated by the pipeline                                  |
| ├── `bam_files/`               | Aligned BAMs                                                       |
| ├── `quality_control/`         | QC outputs: plots, summary reports                                 |
| ├── `Stats/`                   | Fastq statistics                                                   |
| ├── `missense_variant.vcf`     | Candidate mutations                                                |
| ├── `results_summary.tsv`      | Table of reads count mapped to target regions                      |
| ├── `summary_report.txt/`      | log file of PlasmoMutFinder.R                                      |
| ├── `sankey_plot.*`            | Visualization outputs                                              |
| `README.md`                    | Documentation (this file)                                          |
| `LICENSE`                      | License info                                                       |

---

## Workflow

1. **Input Data**
   - Raw FASTQ sequencing reads (paired-end, Illumina).
   - Reference genome (Pfalciparum.genome.fasta + index files).
   - Sample metadata (labels.xlsx).
   - Gene annotations (Pfalciparum.gff3 + resistance gene lists).
   - Known variant VCFs (known_sites/).
   - Target regions (*.bed).
2. **Mapping & Variant Calling (RawFq2MergedVCF.sh)**
   - Runs bwa, samtools, and GATK to:
     1. Map FASTQ → BAM.
     2. Mark duplicates & sort.
     3. Jointly call variants → merged VCF.
3. **Candidate Variant Filtering (PlasmoMutFinder.R)**
   - Reads merged VCF.
   - Uses labels.xlsx to split samples into Failure vs Success.
   - Retains variants exclusive to the failure group.
   - Exports missense_variant.vcf + results_summary.tsv.
4. **Quality Control Visualization (SeqQualPlot15.R)**
   - Generates plots:
     1. Sankey diagram of read filtering steps.
     2. Barplots of mapping proportions.
     3. Read distribution over targets.
   - Outputs sankey_plot.html/png, barplot.jpeg, scatterplot.jpeg.

---

## Required Files

Before running the pipeline, make sure you have the following files organized in your project directory and your scripts:
- `input_data/*.fastq/`: Raw sequencing reads (ILLUMINA pared-end)
- `input_data/Pfalciparum.genome.fasta/`: Plasmodium falciparum reference genome in FASTA format
- - `input_data/annotations/`: gene annotation reference files (e.g., GFF3) used to map variants to genes and funtional regions
- `input_data/known_sites/`: reference variant databases (e.g., dbSNP) used for base quality score recalibration (BQSR) and variant filtering
- `input_data/labels.xlsx` – Excel file with sample information:  
  - `Sample` column: sample names matching .BAM bash-output files.  
  - `Group` column: `Succes` or `Failure` (treatment outcome labels).  
- `input_data/Newtargets15/`: BED file containing genomic target regions for on-target read analysis
- Any index files generated during preprocessing (`.bai`, `.vcf`, `.bam`).  
- Any intermediate files needed for mapping, filtering, or plotting steps.  

---

## Outputs

- Filtered candidate variants: missense_variant.vcf, results_summary.tsv

- QC plots: Sankey diagram, barplots, scatterplots

- BAM and intermediate VCFs

---

##  Dependencies

### Bash & Bioinformatics Tools

- `bwa`, `samtools`, `GATK`, `bcftools` (for ASEQ1.sh)

### R Packages

```r
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install(c(
    "VariantAnnotation", 
    "vcfR", 
    "rtracklayer", 
    "Rsamtools", 
    "GenomicAlignments"
))
install.packages(c(
    "openxlsx", 
    "networkD3", 
    "htmlwidgets", 
    "webshot2", 
    "tidyr", 
    "tibble", 
    "ggplot2", 
    "dplyr", 
    "SankeyDiagram", 
    "stringr"
))
```

---

## Disclaimer

This project was developed as part of a research internship. The VCF and metadata files were provided by the hosting lab `ESCAPE – EpidémioSurveillance et circulation des parasites dans les environnements – UR 7510`. This pipeline is released for educational and reproducibility purposes.
Raw FASTQ sequencing files are not included in this repository due to size and privacy restrictions.
Publicly available sequencing data for this study will be deposited at the European Nucleotide Archive (ENA).
Once available, the ENA project accession will be provided here for direct download.

---

## Citation

In Preparation

---
